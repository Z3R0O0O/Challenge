# pip install pyinotify

import os
import time
import subprocess
from pyinotify import WatchManager, Notifier, ProcessEvent, IN_MODIFY

# Diretório e arquivo que serão monitorados
dir_to_watch = '/home/cobaia'
file_to_watch = '.bash_history'
full_path = os.path.join(dir_to_watch, file_to_watch)

# Palavras a serem procuradas
keywords = ['su', 'sudo']

# Classe para manipular eventos
class EventHandler(ProcessEvent):
    def process_IN_MODIFY(self, event):
        if event.pathname == full_path:
            with open(full_path, 'r') as f:
                content = f.read()
                for keyword in keywords:
                    if keyword in content:
                        print(f"A palavra '{keyword}' foi encontrada em {file_to_watch}")
                        subprocess.run(['bash', '-i'])

# Configuração do monitoramento
wm = WatchManager()
mask = IN_MODIFY
handler = EventHandler()
notifier = Notifier(wm, handler)

# Inicia o monitoramento
wdd = wm.add_watch(dir_to_watch, mask, rec=True)

print(f"Monitorando {dir_to_watch}/{file_to_watch} em busca das palavras: {', '.join(keywords)}")

while True:
    try:
        notifier.process_events()
        if notifier.check_events():
            notifier.read_events()
    except KeyboardInterrupt:
        notifier.stop()
        break

