# pip install pyinotify

import os
import time
import subprocess
from pyinotify import WatchManager, Notifier, ProcessEvent, IN_MODIFY

diretorio = '/home/cobaia'                              # O que será monitorado
arquivo = '.bash_history'
caminho = os.path.join(diretorio, arquivo)

palavras = ['su', 'sudo']                               # Palavras a serem procuradas

class EventHandler(ProcessEvent):                       # Classe para manipular eventos
    def process_IN_MODIFY(self, event):
        if event.pathname == caminho:
            with open(caminho, 'r') as f:
                content = f.read()
                for chaves in palavras:
                    if chaves in content:
                        print(f"A palavra '{chaves}' foi encontrada em {arquivo}")
                        subprocess.run(['bash', '-i'])

wm = WatchManager()                                      # Configuração para o monitoramento
mask = IN_MODIFY
handler = EventHandler()
notifier = Notifier(wm, handler)

monitor = wm.add_watch(diretorio, mask, rec=True)              # Inicia do monitoramento

print(f"Monitorando {diretorio}/{arquivo}")

while True:
    try:
        notifier.process_events()
        if notifier.check_events():
            notifier.read_events()
    except KeyboardInterrupt:
        notifier.stop()
        break
        break

